#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 9.1'
require 'gtk2applib'
require 'gtk2checkboxes'
include Gtk2AppLib
include Configuration

program = Program.new({
	'name'		=> 'Ruby-Gnome CheckBoxes',
        'authors'       => ['carlosjhr64@gmail.com'],
        'website'       => 'http://ruby-gnome-apps.blogspot.com/search/label/Checkboxes',
        'website-label'	=> 'Ruby-Gnome CheckBoxes Blog',
        'license'       => 'GPL',
        'copyright'     => '2010-09-09 15:27:24',
  })

begin
  program.window do |window|
    program.append_app_menu( Gtk::SeparatorMenuItem.new )

    ### GUI ###
    scrolled_window	= Widgets::ScrolledWindow.new(window)
    notebook		= Gtk2CheckBoxes::Notebook.new(scrolled_window)

    ### Actions ###
    ## Add Tab ##
    program.append_app_menu('_Add Tab'){
      if tab = DIALOGS.entry(*TABNAME_DIALOG) then
        if tab=~/^\w+$/ && !notebook.has_tab?(tab) then
          notebook.add_page(tab)
        else
          DIALOGS.quick_message(*ERROR_MESSAGE)
        end
      end
    }
    ## Delete Tab ##
    program.append_app_menu('_Delete Tab'){
      if tab = DIALOGS.choose_tags(notebook.tabs.sort,TABNAME_CHOOSE_OPTIONS) then
        notebook.delete(tab)
      end
    }

    ### STATE PRESERVATION ###
    window.signal_connect('destroy'){
      alloc = window.allocation
      WINDOW_DEFAULT_SIZE[0],WINDOW_DEFAULT_SIZE[1] = alloc.width,alloc.height
      APPLICATION[:Page]=notebook.page
    }
    if page = APPLICATION[:Page] then
      Gtk.timeout_add(TIMEOUT[:XXShort]){
        notebook.set_page(page)
        false
      }
    end
  end
rescue Exception
  $!.puts_bang!
ensure
  program.finalize
end
